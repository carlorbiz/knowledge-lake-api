# Workflow Fixes - Copy & Paste Values

**Quick reference for all code to copy-paste into n8n**

---

## Fix 1: Manus Call Node

**Node**: "Manus Call"

**JSON Body** (replace existing):
```json
{
  "prompt": "{{$json.command_text}}",
  "taskMode": "agent"
}
```

---

## Fix 2: Add New Node "Format Manus Response"

**Position**: Between "Manus Call" and "Query Knowledge Lake"

**Node Type**: Code

**Name**: `Format Manus Response`

**JavaScript Code**:
```javascript
// Get data from both previous nodes
const parsedData = $('Parse Slack Command').item.json;
const manusResponse = $input.first().json;

// Extract Manus response
const documentUrl = manusResponse.documentUrl || '';
const templateUsed = manusResponse.template_used || 'Unknown';
const reasoning = manusResponse.reasoning || 'Manus processed this content';

// Pass through all original data plus Manus results
return {
  json: {
    // Original data from Parse Slack Command
    user_id: parsedData.user_id,
    user_name: parsedData.user_name,
    command_text: parsedData.command_text,
    original_text: parsedData.original_text,
    channel_id: parsedData.channel_id,
    response_url: parsedData.response_url,
    priority: parsedData.priority,
    category: parsedData.category,
    agent: 'manus', // Override to show Manus handled it
    timestamp: parsedData.timestamp,

    // Manus results
    documentUrl: documentUrl,
    template_used: templateUsed,
    manus_reasoning: reasoning,

    // For Notion
    notion_title: parsedData.notion_title,
    notion_status: 'Processed by Manus',
    notion_agent: 'Manus',

    // For routing
    processed_by_manus: true,
    original_command: parsedData.command_text
  }
};
```

**Connections**:
- Input: From "Manus Call"
- Output: To "Query Knowledge Lake"

---

## Fix 3: Update "Format for Github" Node

**Node**: "Format for Github"

**Replace entire JavaScript code with**:
```javascript
// Get data - could come from Parse Slack Command or Format Manus Response
const data = $input.first().json;

// Determine if this was processed by Manus
const processedByManus = data.processed_by_manus || false;
const documentUrl = data.documentUrl || '';

// Extract core fields
const commandText = data.original_command || data.command_text || data.text || 'No command text found';
const userName = data.user_name || 'unknown';
const channelId = data.channel_id || 'unknown';
const timestamp = data.timestamp || new Date().toISOString();
const userId = data.user_id || 'unknown';
const responseUrl = data.response_url || '';
const agent = data.agent || 'claude-code';
const category = data.category || 'general';
const priority = data.priority || 'normal';

// Create short title
let title = commandText;
if (title && title.length > 80) {
  const firstPeriod = title.indexOf('. ');
  if (firstPeriod > 0 && firstPeriod < 80) {
    title = title.substring(0, firstPeriod);
  } else {
    title = title.substring(0, 77) + '...';
  }
}

// Create body based on processing path
let body;

if (processedByManus && documentUrl) {
  // Manus path - include document link
  const templateUsed = data.template_used || 'Unknown';
  const manusReasoning = data.manus_reasoning || 'Processed by Manus AI';

  body = `## ðŸ“„ Document Generated by Manus

**Google Doc**: ${documentUrl}

**Template Used**: ${templateUsed}

**Manus Reasoning**: ${manusReasoning}

---

## Original Request

${commandText}

---

## Metadata

**From:** ${userName} (${userId})
**Channel:** <#${channelId}>
**Priority:** ${priority}
**Category:** ${category}
**Timestamp:** ${timestamp}
**Agent:** ${agent}

---

## Knowledge Lake Context

*Knowledge Lake query results will be added below by the workflow*

---

**Status:** ðŸŸ¢ PROCESSED BY MANUS

_Document available at the link above. This issue tracks the original request for reference._`;

} else {
  // Standard CC path - no Manus processing
  body = `## Task

${commandText}

---

## Metadata

**From:** ${userName} (${userId})
**Channel:** <#${channelId}>
**Priority:** ${priority}
**Category:** ${category}
**Timestamp:** ${timestamp}
**Agent:** ${agent}

---

## Knowledge Lake Context

*Knowledge Lake query results will be added below*

---

**Status:** ðŸ”µ QUEUED

_CC: Please process this task and comment with your response. Close the issue when complete._`;
}

return {
  json: {
    title: `${userName}: ${title}`,
    body: body,
    user_name: userName,
    channel_id: channelId,
    response_url: responseUrl,
    agent: agent,
    category: category,
    priority: priority,
    documentUrl: documentUrl, // Pass through for Notion
    processed_by_manus: processedByManus,
    original_command: commandText
  }
};
```

---

## Fix 4: Update "Create Notion Entry" Node

**Node**: "Create Notion Entry"

### Update existing properties:

**Title**:
```
={{ $('Format for Github').item.json.original_command }}
```

**Primary AI Agent**:
```
={{$('Format for Github').item.json.agent === 'claude-code' ? 'Claude Code' : $('Format for Github').item.json.agent === 'manus' ? 'Manus' : $('Format for Github').item.json.agent === 'fred' ? 'Fred (ChatGPT)' : $('Format for Github').item.json.agent === 'gemini' ? 'Gemini (Google)' : $('Format for Github').item.json.agent === 'grok' ? 'Grok (xAI)' : 'Claude (Anthropic)'}}
```

**Instructions**:
```
={{ $('Format for Github').item.json.processed_by_manus ? 'Processed by Manus: ' + $('Format for Github').item.json.documentUrl : 'Queued for ' + $('Format for Github').item.json.agent }}
```

### Add new property (if not already exists):

**Property**: Document URL (type: URL)

**Value**:
```
={{ $('Format for Github').item.json.documentUrl || '' }}
```

---

## Fix 5: Update "Log to Knowledge Lake" Node

**Node**: "Log to Knowledge Lake"

**JSON Body** (replace existing):
```json
{
  "content": "={{ 'Slack /ai command from ' + $('Format for Github').item.json.user_name + ': ' + $('Format for Github').item.json.original_command + '. ' + ($('Format for Github').item.json.processed_by_manus ? 'Processed by Manus. Document: ' + $('Format for Github').item.json.documentUrl : 'Routed to agent: ' + $('Format for Github').item.json.agent) }}",
  "user_id": "={{ $('Format for Github').item.json.user_name }}",
  "metadata": {
    "source": "slack_ai_command",
    "agent": "={{ $('Format for Github').item.json.agent }}",
    "timestamp": "={{ $('Parse Slack Command').item.json.timestamp }}",
    "notion_page_id": "={{ $('Create Notion Entry').item.json.id }}",
    "github_issue": "={{ $('Create Github issue for CC').item.json.number }}",
    "processed_by_manus": "={{ $('Format for Github').item.json.processed_by_manus }}",
    "documentUrl": "={{ $('Format for Github').item.json.documentUrl || '' }}",
    "category": "={{ $('Format for Github').item.json.category }}",
    "priority": "={{ $('Format for Github').item.json.priority }}"
  }
}
```

---

## Fix 6: Update "Send a message" Node

**Node**: "Send a message"

**Text** (replace existing):
```
={{$('Format for Github').item.json.processed_by_manus
  ? 'ðŸ§  Manus created your document!\n\nðŸ“„ View: ' + $('Format for Github').item.json.documentUrl + '\n\nLogged to Notion and GitHub for reference.'
  : 'âœ… Task queued for ' + $('Format for Github').item.json.agent + '. I will notify you when complete.'}}
```

---

## Quick Implementation Checklist

- [ ] Fix 1: Update Manus Call JSON body
- [ ] Fix 2: Add "Format Manus Response" node (between Manus Call and Query Knowledge Lake)
- [ ] Fix 3: Update "Format for Github" JavaScript code
- [ ] Fix 4: Update "Create Notion Entry" properties
- [ ] Fix 5: Update "Log to Knowledge Lake" JSON body
- [ ] Fix 6: Update "Send a message" text
- [ ] Test: Short content (< 1800 chars)
- [ ] Test: Long content (>= 1800 chars with Manus)

---

## Testing Commands

### Short Content Test:
```
/ai cc check system status
```

### Long Content Test (paste at least 1800 chars):
```
/ai cc Research the current state of AI automation in enterprise environments. Investigate adoption rates, key challenges in implementation, ROI metrics, best practices for multi-agent coordination, integration patterns with existing systems, security considerations, compliance requirements, cost-benefit analysis, staff training needs, change management strategies, technology stack recommendations, vendor comparison analysis, deployment models, scalability considerations, monitoring and observability approaches, incident response procedures, business continuity planning, disaster recovery strategies, performance optimization techniques, and future trends in AI automation. Include specific examples from healthcare, finance, retail, and manufacturing sectors. Provide detailed recommendations for organizations at different maturity levels. Analyze both technical and organizational aspects. Consider regulatory requirements in different jurisdictions. Compare cloud-native vs on-premises deployments. Evaluate open-source vs commercial solutions. [Continue with more details to reach 1800+ characters...]
```

---

**All values ready to copy-paste! No typing required.** ðŸ“‹
