# Quick Start: Add Manus to n8n Workflow

## âœ… Prerequisites Complete

- âœ… Manus API key saved to .env
- âœ… Railway MCPs deployed
- âœ… n8n Railway credentials created
- âœ… All 5 templates configured with docIds

---

## Step 1: Create Manus Header Auth Credential in n8n

1. Open n8n settings
2. Go to **Credentials** section
3. Click **+ Add Credential**
4. Select **Header Auth**
5. Configure:
   - **Name**: `Manus API Key`
   - **Header Name**: `API_KEY`
   - **Header Value**: `[paste your Manus API key from .env file]`
6. Click **Save**

---

## Step 2: Add IF Node to Check Content Length

**After**: "Parse Slack Command" node

**Node Name**: "Should Route to Manus?"

**Node Type**: IF

**Condition**:
```javascript
{{$json.command_text.length >= 1800}}
```

**Connect**:
- `true` output â†’ (new) Call Manus API
- `false` output â†’ (existing) Your GitHub/CC flow

---

## Step 3: Add HTTP Request Node for Manus

**After**: "Should Route to Manus?" (true branch)

**Node Name**: "Call Manus API"

**Node Type**: HTTP Request

### Configuration:

**Authentication**:
- Type: **Existing Credential**
- Select: `Manus API Key` (the credential you just created)

**Method**: POST

**URL**: `https://api.manus.ai/v1/tasks`

**Send Body**: Yes

**Body Content Type**: JSON

**JSON/RAW Parameters**: On

**Body**:
```json
{
  "prompt": "{{$node['Parse Slack Command'].json.command_text}}",
  "taskMode": "agent"
}
```

**Note**: If `command_text` doesn't work, check the Parse Slack Command output and adjust the field name.

### Expected Response from Manus:
```json
{
  "documentUrl": "https://docs.google.com/document/d/..."
}
```

---

## Step 4: Add Notion Node

**After**: "Call Manus API"

**Node Name**: "Log to Notion (Manus Doc)"

**Node Type**: Notion

### Configuration:

**Resource**: Database Page

**Operation**: Create

**Database ID**: [Your AI Agent Universal Conversations Database ID]

**Properties**:

| Property Name | Value |
|--------------|-------|
| **Title** | `{{$node['Parse Slack Command'].json.notion_title}}` |
| **Document URL** | `{{$node['Call Manus API'].json.documentUrl}}` |
| **Agent** | `Manus` |
| **User** | `{{$node['Parse Slack Command'].json.user_name}}` |
| **Channel** | `{{$node['Parse Slack Command'].json.channel_id}}` |
| **Content Type** | `AI Generated Document` |
| **Source** | `Slack` |
| **Created Date** | `{{$now}}` |

---

## Step 5: Add Slack Response Node

**After**: "Log to Notion (Manus Doc)"

**Node Name**: "Reply to Slack (Manus Doc)"

**Node Type**: HTTP Request

### Configuration:

**Authentication**: None (uses response_url)

**Method**: POST

**URL**: `{{$node['Parse Slack Command'].json.response_url}}`

**Send Body**: Yes

**Body Content Type**: JSON

**Body**:
```json
{
  "response_type": "in_channel",
  "text": ":brain: Manus created your document!",
  "blocks": [
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": ":page_facing_up: *<{{$node['Call Manus API'].json.documentUrl}}|View Google Doc>*"
      }
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "mrkdwn",
          "text": "Generated by Manus AI | Logged to Notion"
        }
      ]
    }
  ]
}
```

---

## Complete Workflow Sequence

```
Parse Slack Command
    â†“
Should Route to Manus? (IF)
    â†“
    â”œâ”€ false â†’ [Your existing GitHub/CC flow]
    â”‚
    â””â”€ true â†’ Call Manus API (HTTP)
                  â†“
              Log to Notion (Manus Doc) (Notion)
                  â†“
              Reply to Slack (Manus Doc) (HTTP)
```

---

## Visual n8n Layout

```
[Parse Slack Command]
         â”‚
         â”‚
[Should Route to Manus?]
    â•±        â•²
falseâ•±         â•²true
   â•±            â•²
[Format for    [Call Manus API]
 GitHub]              â”‚
   â”‚                  â”‚
[Create           [Log to Notion
 GitHub Issue]     (Manus Doc)]
   â”‚                  â”‚
[existing          [Reply to Slack
 flow...]           (Manus Doc)]
```

---

## Testing

### Test Case 1: Short Content (GitHub Flow)

```
/ai cc check system status
```

**Expected**:
- Routes to `false` branch
- Creates GitHub issue
- Uses existing CC processing

### Test Case 2: Long Content (Manus Flow)

```
/ai cc [Paste 2000+ characters of content about AI automation]
```

**Expected**:
- Routes to `true` branch
- Calls Manus API
- Manus analyzes and selects template
- Returns Google Doc URL
- Stored in Notion
- Reply in Slack with doc link

### Test Case 3: Research Request (Manus Flow)

```
/ai cc Investigate the best practices for AI agent coordination in enterprise environments. Analyze current market solutions and provide comprehensive recommendations with sources.
```

**Expected**:
- Routes to Manus (>1800 chars)
- Manus selects `AAE_Research_Summary` template
- Creates structured research document
- Returns Google Doc URL

---

## Troubleshooting

### Issue: "Cannot read properties of undefined"

**Cause**: Field name in expression is wrong

**Fix**:
1. Run Parse Slack Command node
2. Check its output
3. Update expressions to match actual field names

### Issue: "401 Unauthorized" from Manus API

**Cause**: API key incorrect or missing

**Fix**:
1. Check credential: `Manus API Key`
2. Verify header name is `API_KEY` (case-sensitive)
3. Verify API key value is correct

### Issue: No response from Manus

**Cause**: API might be processing (long content takes time)

**Fix**:
1. Increase HTTP Request timeout to 60 seconds
2. Check Manus task dashboard for status

### Issue: Notion node fails

**Cause**: Property names don't match database

**Fix**:
1. Check your Notion database properties
2. Match property names exactly (case-sensitive)
3. Ensure property types are correct (URL for doc link)

---

## What Happens Behind the Scenes

When you send content to Manus:

1. **Manus receives** the prompt via his API
2. **Analyzes content** using his decision tree
3. **Selects template** from the 5 options:
   - `AAE_DeepDive_Analysis` (69088da6d852c9556cec26af)
   - `AAE_MultiAgent_Coordination` (690b3d3f3756bfff14626684)
   - `AAE_Status_Update` (690b3f973756bfff14626a7a)
   - `AAE_Research_Summary` (690b3ffa3756bfff14626c17)
   - `AAE_Quick_Note` (690b41a53756bfff1462734e)
4. **Formats data** according to template structure
5. **Calls Railway DocsAutomator MCP** directly:
   ```
   POST https://web-production-14aec.up.railway.app/create_document
   {
     "docId": "[selected template]",
     "data": {...}
   }
   ```
6. **Returns** simple response to n8n:
   ```json
   {
     "documentUrl": "https://docs.google.com/..."
   }
   ```

**All the intelligence lives with Manus!** Your n8n just sends content and receives a URL. ðŸ§ 

---

## Cost Analysis

### Per Document:
- **n8n â†’ Manus API**: 1 HTTP call = 1 workflow execution
- **Manus â†’ Railway MCP**: Internal (no cost to you)
- **Railway MCP â†’ DocsAutomator API**: Included in Railway hosting

### Monthly Costs:
- **Railway hosting**: $7/month (n8n + 2 MCPs)
- **Manus subscription**: [Your existing plan]
- **Zapier for docs**: $0 (eliminated!)

### Savings:
- **Previous Zapier method**: $20-100/month
- **New Manus method**: $0 extra (uses existing Manus plan)
- **Total savings**: $20-100/month! ðŸ’°

---

## Next Steps After Testing

Once basic integration works:

1. **Expand routing logic**: Add more keywords to IF condition
2. **Add Gamma integration**: For presentation requests
3. **Monitor performance**: Check Notion logs for patterns
4. **Refine templates**: Ask Manus to adjust based on output quality
5. **Scale up**: Increase content threshold if needed

---

## Summary

This integration:
- âœ… Uses Manus's intelligence (5 specialized templates)
- âœ… Eliminates Zapier costs
- âœ… Simple n8n workflow (just 4 nodes added)
- âœ… Clean architecture (Manus handles complexity)
- âœ… Scales to unlimited content length

**You're ready to add the nodes!** ðŸš€

Follow the steps above, test with real Slack content, and adjust as needed.
