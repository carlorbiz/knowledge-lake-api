<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concept-to-Course Management Hub | GPSA Healthcare Education</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .section-card { transition: all 0.3s ease; }
        .section-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .status-indicator { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; }
        .status-completed { background-color: #10b981; }
        .status-pending { background-color: #f59e0b; }
        .status-critical { background-color: #ef4444; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .code-block { background-color: #1e293b; color: #e2e8f0; border-radius: 8px; padding: 16px; font-family: 'Monaco', 'Consolas', monospace; font-size: 0.9em; overflow-x: auto; }
        .diagnostic-panel { border-left: 4px solid #3b82f6; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); }
        .critical-panel { border-left: 4px solid #ef4444; background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); }
        .success-panel { border-left: 4px solid #10b981; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-lg">
        <div class="container mx-auto px-6 py-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold mb-2">Concept-to-Course Management Hub</h1>
                    <p class="text-blue-100 text-lg">Australian Healthcare Education Tool | GPSA Enhanced</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-blue-200">Last Updated</div>
                    <div class="text-xl font-semibold" id="currentDate"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Alert Banner -->
    <div class="bg-red-600 text-white px-6 py-3 text-center">
        <i class="fas fa-exclamation-triangle mr-2"></i>
        <strong>Critical Issue Detected:</strong> PDF processing not mentioning uploaded PDFs in course recommendations. 
        <span class="underline cursor-pointer" onclick="scrollToSection('pdf-diagnostic')">Run Diagnostic Now</span>
    </div>

    <div class="container mx-auto px-6 py-8">
        <!-- Quick Status Dashboard -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">System Status Overview</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="section-card bg-white rounded-lg p-6 shadow-md">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-2xl text-green-600"><i class="fas fa-check-circle"></i></div>
                        <span class="status-indicator status-completed"></span>
                    </div>
                    <h3 class="font-semibold text-gray-800 mb-2">Core Functions</h3>
                    <p class="text-sm text-gray-600">TypeError resolved, workflow integrated</p>
                </div>
                
                <div class="section-card bg-white rounded-lg p-6 shadow-md">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-2xl text-red-600"><i class="fas fa-exclamation-triangle"></i></div>
                        <span class="status-indicator status-critical"></span>
                    </div>
                    <h3 class="font-semibold text-gray-800 mb-2">PDF Processing</h3>
                    <p class="text-sm text-gray-600">Not mentioning uploaded PDFs</p>
                </div>
                
                <div class="section-card bg-white rounded-lg p-6 shadow-md">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-2xl text-yellow-600"><i class="fas fa-cogs"></i></div>
                        <span class="status-indicator status-pending"></span>
                    </div>
                    <h3 class="font-semibold text-gray-800 mb-2">User Experience</h3>
                    <p class="text-sm text-gray-600">Wizard enhancements deployed</p>
                </div>
                
                <div class="section-card bg-white rounded-lg p-6 shadow-md">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-2xl text-green-600"><i class="fas fa-shield-alt"></i></div>
                        <span class="status-indicator status-completed"></span>
                    </div>
                    <h3 class="font-semibold text-gray-800 mb-2">Compliance</h3>
                    <p class="text-sm text-gray-600">RACGP/ACRRM standards maintained</p>
                </div>
            </div>
        </section>

        <!-- PDF Processing Diagnostic Section -->
        <section id="pdf-diagnostic" class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">
                <i class="fas fa-file-pdf text-red-600 mr-2"></i>
                PDF Processing Diagnostic
            </h2>
            
            <div class="critical-panel rounded-lg p-6 mb-6">
                <h3 class="font-bold text-lg mb-4">
                    <i class="fas fa-exclamation-circle text-red-600 mr-2"></i>
                    Critical Issue Identified
                </h3>
                <p class="mb-4">Your course recommendations are not mentioning uploaded PDFs despite the files being accessible in the B2 folder. The system should be scanning the B2 folder URL, detecting PDFs, and processing them via the Gemini API.</p>
                
                <div class="bg-white rounded-lg p-4 mb-4">
                    <h4 class="font-semibold mb-2">Expected Workflow:</h4>
                    <ol class="list-decimal list-inside space-y-1 text-sm">
                        <li><code>collectAllSourceMaterials_()</code> scans B2 folder URL</li>
                        <li><code>processOne_()</code> processes folders via DriveApp.getFolderById()</li>
                        <li><code>readDriveFileText_()</code> finds PDFs and adds to result.pdfFiles array</li>
                        <li><code>generateCourseRecommendation()</code> calls <code>callGeminiWithPDFs()</code> when PDFs found</li>
                        <li>Gemini API processes PDFs and includes content in recommendations</li>
                    </ol>
                </div>
                
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <h4 class="font-semibold text-red-800 mb-2">Deployment Required</h4>
                    <p class="text-red-700 text-sm">Deploy the diagnostic function below to identify the exact failure point in your PDF processing pipeline.</p>
                </div>
            </div>

            <!-- Diagnostic Deployment Panel -->
            <div class="diagnostic-panel rounded-lg p-6 mb-6">
                <h3 class="font-bold text-lg mb-4">
                    <i class="fas fa-stethoscope text-blue-600 mr-2"></i>
                    Diagnostic Function Deployment
                </h3>
                
                <div class="space-y-4">
                    <div class="bg-white rounded-lg p-4">
                        <h4 class="font-semibold mb-2">Step 1: Add Diagnostic Function</h4>
                        <p class="text-sm text-gray-600 mb-3">Copy and paste this diagnostic function into your Google Apps Script:</p>
                        
                        <div class="code-block mb-3">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-xs text-gray-400">PDF-PROCESSING-DIAGNOSTIC.js</span>
                                <button onclick="copyToClipboard('diagnostic-code')" class="text-xs bg-blue-600 text-white px-2 py-1 rounded">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                            </div>
                            <pre id="diagnostic-code">/**
 * PDF PROCESSING DIAGNOSTIC - Add to your Google Apps Script
 */
function diagnosticPDFProcessing() {
  try {
    const ui = SpreadsheetApp.getUi();
    const sh = SpreadsheetApp.getActiveSheet();
    
    if (sh.getName() !== 'Mapping') {
      return ui.alert('Run this on the Mapping tab, with a course row selected.');
    }
    
    const row = sh.getActiveRange().getRow();
    if (row < 2) {
      return ui.alert('Select a course row (row 2 or higher).');
    }
    
    const concept = sh.getRange(row, 1).getValue();
    const b2Value = sh.getRange(row, 2).getValue();
    
    ui.alert(
      'PDF Processing Diagnostic Started',
      `Testing PDF processing for:\n\nConcept: ${concept}\nB2 Value: ${b2Value}\n\nCheck the logs for results.`,
      ui.ButtonSet.OK
    );
    
    Logger.log('=== PDF PROCESSING DIAGNOSTIC ===');
    Logger.log(`Concept: ${concept}`);
    Logger.log(`B2 Value: ${b2Value}`);
    
    const srcPack = collectAllSourceMaterials_(row);
    
    Logger.log('=== SOURCE PACK RESULTS ===');
    Logger.log(`Text length: ${srcPack.text ? srcPack.text.length : 0} characters`);
    Logger.log(`Errors: ${srcPack.errors.length}`);
    Logger.log(`Sources: ${srcPack.sources.length}`);
    Logger.log(`PDF Files: ${srcPack.pdfFiles ? srcPack.pdfFiles.length : 0}`);
    
    if (srcPack.pdfFiles && srcPack.pdfFiles.length > 0) {
      Logger.log('=== PDF FILES FOUND ===');
      srcPack.pdfFiles.forEach((pdf, index) => {
        Logger.log(`PDF ${index + 1}: ${pdf.name}`);
      });
    } else {
      Logger.log('❌ No PDF files found - investigating...');
      
      if (b2Value && String(b2Value).includes('drive.google.com/folders/')) {
        const folderMatch = String(b2Value).match(/\/folders\/([a-zA-Z0-9_-]+)/);
        if (folderMatch) {
          const folder = DriveApp.getFolderById(folderMatch[1]);
          const files = folder.getFiles();
          
          let pdfCount = 0;
          while (files.hasNext()) {
            const file = files.next();
            if (file.getBlob().getContentType() === 'application/pdf') {
              pdfCount++;
              Logger.log(`✅ PDF found in folder: ${file.getName()}`);
            }
          }
          
          Logger.log(`Manual folder scan: ${pdfCount} PDFs found`);
        }
      }
    }
    
    const summary = `PDF Diagnostic Complete!\n\n` +
      `PDFs found: ${srcPack.pdfFiles ? srcPack.pdfFiles.length : 0}\n` +
      `Errors: ${srcPack.errors.length}\n\n` +
      `Check Apps Script logs for details.`;
    
    ui.alert('Diagnostic Results', summary, ui.ButtonSet.OK);
    
  } catch (error) {
    Logger.log(`Diagnostic error: ${error.toString()}`);
    SpreadsheetApp.getUi().alert('Error', `Diagnostic failed: ${error.message}`);
  }
}</pre>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4">
                        <h4 class="font-semibold mb-2">Step 2: Run Diagnostic</h4>
                        <ol class="list-decimal list-inside space-y-1 text-sm">
                            <li>Open your Concept-to-Course Google Sheets document</li>
                            <li>Go to the <strong>Mapping</strong> tab</li>
                            <li>Click on a course row that has uploaded PDFs in the B2 folder</li>
                            <li>Run the diagnostic function from the Apps Script editor</li>
                            <li>Check the execution logs for detailed analysis</li>
                        </ol>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4">
                        <h4 class="font-semibold mb-2">Step 3: Report Results</h4>
                        <p class="text-sm text-gray-600">The diagnostic will identify:</p>
                        <ul class="list-disc list-inside space-y-1 text-sm mt-2">
                            <li>Whether B2 folder is being accessed correctly</li>
                            <li>Whether PDFs are being detected in the folder</li>
                            <li>Whether the <code>callGeminiWithPDFs</code> function exists</li>
                            <li>Any errors in the PDF processing pipeline</li>
                            <li>Folder permission issues</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quick Actions Panel -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Quick Actions</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <div class="section-card bg-white rounded-lg p-6 shadow-md">
                    <div class="text-2xl text-blue-600 mb-4"><i class="fas fa-bug"></i></div>
                    <h3 class="font-semibold text-gray-800 mb-3">Debug PDF Processing</h3>
                    <p class="text-sm text-gray-600 mb-4">Run comprehensive diagnostic to identify why PDFs aren't being processed.</p>
                    <button onclick="showDeploymentInstructions('pdf-diagnostic')" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition">
                        View Instructions
                    </button>
                </div>
                
                <div class="section-card bg-white rounded-lg p-6 shadow-md">
                    <div class="text-2xl text-green-600 mb-4"><i class="fas fa-archive"></i></div>
                    <h3 class="font-semibold text-gray-800 mb-3">Deploy Archival Fix</h3>
                    <p class="text-sm text-gray-600 mb-4">Enhanced archival function with proper sheet cleanup.</p>
                    <button onclick="showDeploymentInstructions('archival-fix')" class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition">
                        Deploy Fix
                    </button>
                </div>
                
                <div class="section-card bg-white rounded-lg p-6 shadow-md">
                    <div class="text-2xl text-purple-600 mb-4"><i class="fas fa-magic"></i></div>
                    <h3 class="font-semibold text-gray-800 mb-3">Update Wizard</h3>
                    <p class="text-sm text-gray-600 mb-4">User-friendly wizard with improved error handling.</p>
                    <button onclick="showDeploymentInstructions('wizard-fix')" class="w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition">
                        Deploy Update
                    </button>
                </div>
                
            </div>
        </section>

        <!-- Technical Documentation -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Technical Documentation</h2>
            
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="border-b border-gray-200">
                    <nav class="flex">
                        <button onclick="showTab('workflow')" class="tab-button px-6 py-4 text-sm font-medium text-gray-700 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600 active" data-tab="workflow">
                            10-Step Workflow
                        </button>
                        <button onclick="showTab('functions')" class="tab-button px-6 py-4 text-sm font-medium text-gray-700 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600" data-tab="functions">
                            Function Reference
                        </button>
                        <button onclick="showTab('compliance')" class="tab-button px-6 py-4 text-sm font-medium text-gray-700 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600" data-tab="compliance">
                            Compliance Guide
                        </button>
                    </nav>
                </div>
                
                <div class="p-6">
                    <div id="tab-workflow" class="tab-content">
                        <h3 class="text-lg font-semibold mb-4">Optimised 10-Step Course Creation Workflow</h3>
                        <div class="space-y-3">
                            <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                                <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">1</span>
                                <div>
                                    <h4 class="font-medium">Setup Course</h4>
                                    <p class="text-sm text-gray-600">Configure mapping sheet and folder structure</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                                <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">2</span>
                                <div>
                                    <h4 class="font-medium">Generate Recommendation</h4>
                                    <p class="text-sm text-gray-600">AI-powered analysis with PDF processing</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                                <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">3</span>
                                <div>
                                    <h4 class="font-medium">Extract Modules</h4>
                                    <p class="text-sm text-gray-600">Automated module extraction with enhanced prompts</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3 p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                                <span class="bg-green-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">4</span>
                                <div>
                                    <h4 class="font-medium">Generate LMS Content ✨</h4>
                                    <p class="text-sm text-gray-600">Integrated LMS generation for workflow efficiency</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                                <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">5</span>
                                <div>
                                    <h4 class="font-medium">Create Voiceover Scripts</h4>
                                    <p class="text-sm text-gray-600">Professional audio content preparation</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="tab-functions" class="tab-content hidden">
                        <h3 class="text-lg font-semibold mb-4">Critical Function Status</h3>
                        <div class="space-y-4">
                            <div class="border border-red-200 rounded-lg p-4 bg-red-50">
                                <div class="flex items-center mb-2">
                                    <span class="status-indicator status-critical"></span>
                                    <code class="font-mono text-sm">collectAllSourceMaterials_()</code>
                                </div>
                                <p class="text-sm text-red-700">Issue: Not properly processing PDFs from B2 folder</p>
                                <p class="text-xs text-red-600 mt-1">Status: Requires diagnostic investigation</p>
                            </div>
                            
                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <div class="flex items-center mb-2">
                                    <span class="status-indicator status-completed"></span>
                                    <code class="font-mono text-sm">archiveCourse()</code>
                                </div>
                                <p class="text-sm text-green-700">Fixed: Enhanced with intelligent sheet cleanup</p>
                                <p class="text-xs text-green-600 mt-1">Status: Ready for deployment</p>
                            </div>
                            
                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <div class="flex items-center mb-2">
                                    <span class="status-indicator status-completed"></span>
                                    <code class="font-mono text-sm">launchCourseCreationWizard()</code>
                                </div>
                                <p class="text-sm text-green-700">Enhanced: User-friendly experience with proper error handling</p>
                                <p class="text-xs text-green-600 mt-1">Status: Ready for deployment</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="tab-compliance" class="tab-content hidden">
                        <h3 class="text-lg font-semibold mb-4">Australian Healthcare Standards Compliance</h3>
                        <div class="space-y-4">
                            <div class="success-panel rounded-lg p-4">
                                <h4 class="font-semibold mb-2">✅ RACGP Standards</h4>
                                <ul class="text-sm space-y-1">
                                    <li>• Professional healthcare tone maintained</li>
                                    <li>• Australian English (en-AU) enforced</li>
                                    <li>• Primary care context emphasis</li>
                                    <li>• Cultural safety requirements met</li>
                                </ul>
                            </div>
                            
                            <div class="success-panel rounded-lg p-4">
                                <h4 class="font-semibold mb-2">✅ ACRRM Standards</h4>
                                <ul class="text-sm space-y-1">
                                    <li>• Rural and remote context included</li>
                                    <li>• Supervision best practices aligned</li>
                                    <li>• Assessment for learning principles</li>
                                    <li>• Psychological safety emphasis</li>
                                </ul>
                            </div>
                            
                            <div class="success-panel rounded-lg p-4">
                                <h4 class="font-semibold mb-2">✅ Vancouver Citation Requirements</h4>
                                <ul class="text-sm space-y-1">
                                    <li>• Numerical citations [1], [2], [3] format</li>
                                    <li>• Proper journal abbreviations</li>
                                    <li>• Australian source preference</li>
                                    <li>• Real source verification enforced</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center text-gray-600 text-sm py-8 border-t border-gray-200">
            <p>&copy; 2024 GPSA Healthcare Education | Concept-to-Course Management Hub</p>
            <p class="mt-2">Enhanced for Australian healthcare standards compliance | Last updated: <span id="footerDate"></span></p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script>
        // Set current date
        const now = new Date();
        document.getElementById('currentDate').textContent = now.toLocaleDateString('en-AU');
        document.getElementById('footerDate').textContent = now.toLocaleDateString('en-AU');

        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active', 'border-blue-600', 'text-blue-600');
            });
            
            // Show selected tab content
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            
            // Add active class to selected tab button
            const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
            activeButton.classList.add('active', 'border-blue-600', 'text-blue-600');
        }

        // Copy to clipboard function
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent || element.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                // Show success feedback
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check mr-1"></i>Copied!';
                button.classList.add('bg-green-600');
                button.classList.remove('bg-blue-600');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-600');
                    button.classList.add('bg-blue-600');
                }, 2000);
            });
        }

        // Scroll to section
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
        }

        // Show deployment instructions
        function showDeploymentInstructions(type) {
            let title, instructions;
            
            switch(type) {
                case 'pdf-diagnostic':
                    scrollToSection('pdf-diagnostic');
                    break;
                case 'archival-fix':
                    alert('Archival Fix Deployment\n\nDeploy the CRITICAL-ARCHIVAL-FIX.js file to resolve sheet deletion issues in the archival function.');
                    break;
                case 'wizard-fix':
                    alert('Wizard Enhancement Deployment\n\nDeploy the USER-FRIENDLY-WIZARD-FIX.js file to improve the user experience and error handling in the course creation wizard.');
                    break;
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Set default active tab
            showTab('workflow');
        });
    </script>
</body>
</html>